let isGrabbing = false; // Kiểm tra user có đang túm phần tử k 

const dragBlock = document.querySelector(".drag");
const dropZone = document.querySelector(".dropzone");

// Tạo độ của trỏ chuột
let mouseCoord = {
    x: 0,
    y: 0,
}

// Túm phần tử và kéo 
dragBlock.addEventListener("mousedown", function (e) {
    isGrabbing = true; // Đang túm 

    // Lấy tạo độ khi túm
    mouseCoord.x = e.clientX;
    mouseCoord.y = e.clientY;
});

// Hàm kiểm tra xem phần tử có nằm trong drop-zone k
function checkInDropZone(x, y) {
    const left = dropZone.offsetLeft;
    const right = dropZone.offsetLeft + dropZone.offsetWidth;
    const top = dropZone.offsetTop;
    const bottom = dropZone.offsetTop + dropZone.offsetHeight;

    return x >= left && x <= right && y >= top && y <= bottom;
}

// Thả phần tử 
document.addEventListener("mouseup", function (e) {
    const inDropZone = checkInDropZone(e.clientX, e.clientY);
    let isInDropZone = false;

    if (inDropZone) {
        dragBlock.classList.add("db-none");
        dragGrow();
    } else {
        setDragPosition(0, 0, false);
    }

    isGrabbing = false; // Đã thả

    mouseCoord.x = 0;
    mouseCoord.y = 0;
});

// Di chuyển phần tử
document.addEventListener("mousemove", function (e) {
    if (isGrabbing) {
        // Quãng đường mới - quãng đường cũ = khoảng cách
        const distanceX = e.clientX - mouseCoord.x;
        const distanceY = e.clientY - mouseCoord.y;

        // Thay đổi vị trị của phần tử
        setDragPosition(distanceX, distanceY);
    }
});

// Hàm di chuyển theo trỏ chuột
function setDragPosition(x, y, instant = true) {
    // Di chuyển theo trỏ chuột
    Object.assign(dragBlock.style, {
        transition: instant ? "none" : "0.5s",
        translate: `${x}px ${y}px`
    });
};

function dragGrow() {
    const dragGrow = document.createElement("div");
    dragGrow.innerText = "Drag me!";
    dragGrow.classList.add("drag-grow");
    const zone = document.querySelector(".dropzone");
    zone.appendChild(dragGrow);
}


// document.addEventListener("click", function (e) {
//     console.log(e);
// });
